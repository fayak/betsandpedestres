{{define "home"}}
  {{template "base" .}}
{{end}}

{{define "content"}}
  <h1>{{.Content.Title}}</h1>

  {{if .Content.ShowSignup}}
    <section style="margin:20px 0; max-width:600px;">
      <p>{{.Content.Description}}</p>
      {{if eq .Content.SignupStatus "ok"}}
        <div class="pill" style="background:#1f3d2b; border:1px solid #4ade80; margin-bottom:12px;">
          Account request submitted! Please wait for an admin to approve it.
        </div>
      {{else if eq .Content.SignupStatus "exists"}}
        <div class="pill" style="background:#3a1d1d; border:1px solid #a33; margin-bottom:12px;">
          That username is already taken. Please pick another.
        </div>
      {{else if eq .Content.SignupStatus "missing"}}
        <div class="pill" style="background:#3a1d1d; border:1px solid #a33; margin-bottom:12px;">
          Please fill out every field.
        </div>
      {{else if eq .Content.SignupStatus "rate"}}
        <div class="pill" style="background:#3a1d1d; border:1px solid #a33; margin-bottom:12px;">
          Too many signup attempts. Please wait a bit and try again.
        </div>
      {{else if eq .Content.SignupStatus "error"}}
        <div class="pill" style="background:#3a1d1d; border:1px solid #a33; margin-bottom:12px;">
          Something went wrong. Try again later.
        </div>
      {{end}}
      <form method="POST" action="/register" style="display:grid; gap:12px;">
        <label>
          <div>Username</div>
          <input name="username" required autocomplete="off" placeholder="your-handle">
        </label>
        <label>
          <div>Display name</div>
          <input name="display_name" required autocomplete="off" placeholder="How others see you">
        </label>
        <label>
          <div>Password</div>
          <input type="password" name="password" required placeholder="Choose a password">
        </label>
        <button class="primary">Request account</button>
      </form>
    </section>
  {{else if .Content.ShowPending}}
    <section style="margin:20px 0; max-width:600px;">
      <div class="pill" style="background:#1f2937; border:1px solid #f59e0b;">
        Your account is pending approval from an administrator. You will gain access once approved.
      </div>
    </section>
  {{else}}
  <form method="GET" action="/" class="filter-bar accent-panel soft">
    <label>Sort
      <select name="sort" onchange="this.form.submit()">
        {{range .Content.SortChoices}}
          <option value="{{.Key}}" {{if eq $.Content.Sort .Key}}selected{{end}}>{{.Label}}</option>
        {{end}}
      </select>
    </label>

    <label>Creator
      <select name="user" onchange="this.form.submit()">
        <option value="" {{if eq .Content.UserFilter ""}}selected{{end}}>(All)</option>
        {{range .Content.Creators}}
          <option value="{{.Username}}" {{if eq $.Content.UserFilter .Username}}selected{{end}}>{{.DisplayName}}</option>
        {{end}}
      </select>
    </label>

    <label>Participation
      <select name="p" {{if not .Header.LoggedIn}}disabled{{end}} onchange="this.form.submit()">
        <option value="all"   {{if eq .Content.PartFilter "all"}}selected{{end}}>All bets</option>
        <option value="me"    {{if eq .Content.PartFilter "me"}}selected{{end}}>I participated</option>
        <option value="notme" {{if eq .Content.PartFilter "notme"}}selected{{end}}>I didn't</option>
      </select>
    </label>

    <label>Status
      <select name="exp" onchange="this.form.submit()">
        <option value="unresolved" {{if eq .Content.ExpiryFilter "unresolved"}}selected{{end}}>Unresolved</option>
        <option value="open"    {{if eq .Content.ExpiryFilter "open"}}selected{{end}}>Open bets</option>
        <option value="expired" {{if eq .Content.ExpiryFilter "expired"}}selected{{end}}>Past the deadline</option>
        <option value="waiting" {{if eq .Content.ExpiryFilter "waiting"}}selected{{end}}>Waiting for decision</option>
        <option value="closed"  {{if eq .Content.ExpiryFilter "closed"}}selected{{end}}>Closed</option>
        <option value="all"     {{if eq .Content.ExpiryFilter "all"}}selected{{end}}>All</option>
      </select>
    </label>

    <input type="hidden" name="page" value="{{.Content.Page}}">
    <input type="hidden" name="size" value="{{.Content.Size}}">
    <a class="pill" href="/">Reset</a>
    <a class="pill" href="/bets/new">Create a bet</a>
    <a class="pill" href="/transactions">Ledger</a>
    <span class="muted">Times shown in <span class="js-tz">your timezone</span></span>
  </form>

  <div style="display:grid; gap:16px;">
    {{range .Content.Rows}}
      <div class="accent-panel card-strip" style="border-radius:10px; border:1px solid #1c2231; padding:16px; background:linear-gradient(135deg,rgba(13,16,26,0.95),rgba(11,13,20,0.92)); display:flex; flex-direction:column; gap:10px;">
        <div class="row" style="justify-content:space-between; align-items:flex-start; gap:12px;">
          <div>
            <h3 style="margin:0"><a href="/bets/{{.ID}}">{{.Title}}</a></h3>
          </div>
          <span class="pill strong" style="background:{{.StatusColor}}; color:#fff; border:none; font-size:0.85em;">{{.StatusLabel}}</span>
        </div>

        <div style="display:flex; flex-direction:column; gap:6px;">
          {{range .Options}}
            <div style="border:1px solid #202637; border-radius:6px; padding:8px; background:linear-gradient(90deg, rgba(192,132,252,0.18) {{.Percent}}%, rgba(13,15,24,0.85) {{.Percent}}%); display:flex; justify-content:space-between; align-items:center;">
              <span>{{.Label}}</span>
              <strong>{{.Percent}}%</strong>
            </div>
          {{end}}
        </div>

        <div class="row" style="gap:8px; flex-wrap:wrap">
          <span class="pill">ü¶∂ Stakes: {{.Stakes}} PiedPi√®ces</span>
          <span class="pill">üë• Participants: {{.Participants}}</span>
          <span class="pill">
            Deadline:
            {{if .Deadline}}
              {{if eq .ExpiresIn "expired"}}
                expired
              {{else}}
                <span class="dt" data-iso="{{.Deadline.UTC.Format "2006-01-02T15:04:05Z07:00"}}"></span>{{if .ExpiresIn}} ¬∑ expires in {{.ExpiresIn}}{{end}}
              {{end}}
            {{else}}‚Äî{{end}}
          </span>
        </div>

        <div class="row" style="justify-content:space-between; align-items:center; font-size:0.85em; color:#7d8499;">
          <span>by {{if .CreatorUser}}<a href="/profile/{{.CreatorUser}}">{{.CreatorName}}</a>{{else}}{{.CreatorName}}{{end}}</span>
          <span style="margin-left:auto;">Created <span class="dt" data-iso="{{.CreatedAt.UTC.Format "2006-01-02T15:04:05Z07:00"}}"></span></span>
        </div>
      </div>
    {{else}}
      <p class="muted">No bets found.</p>
    {{end}}
  </div>

  <nav style="display:flex; gap:8px; margin-top:16px">
    {{if .Content.HasPrev}}<a href="{{.Content.PrevURL}}">‚Üê Prev</a>{{end}}
    {{if .Content.HasNext}}<a href="{{.Content.NextURL}}">Next ‚Üí</a>{{end}}
  </nav>
  {{end}}
{{end}}
