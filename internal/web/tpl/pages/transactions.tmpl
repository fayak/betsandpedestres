{{define "transactions"}}
  {{template "base" .}}
{{end}}

{{define "content"}}
  <style>
    .ledger-shell {position:relative; padding:28px; border-radius:18px; border:1px solid #1c2231; background-image:linear-gradient(145deg,rgba(10,12,20,0.92),rgba(7,9,16,0.96)), url('/assets/bogda.jpg'); background-size:cover; background-position:center; background-repeat:no-repeat; background-attachment:fixed; box-shadow:0 25px 60px rgba(0,0,0,0.45); overflow:hidden;}
    .ledger-shell::after {content:""; position:absolute; inset:0; background:linear-gradient(180deg,rgba(5,6,10,0.4),rgba(5,6,10,0.75));}
    .ledger-shell > * {position:relative; z-index:1;}
    .ledger-table-wrap {overflow:auto; margin-top:18px; border-radius:12px; border:1px solid rgba(255,255,255,0.08); background:rgba(6,7,12,0.9); box-shadow:0 10px 40px rgba(0,0,0,0.45);}
    .ledger-table {width:100%; border-collapse:collapse; min-width:720px;}
    .ledger-table thead th {text-align:left; padding:12px; font-size:0.78rem; letter-spacing:0.08em; text-transform:uppercase; border-bottom:1px solid rgba(255,255,255,0.12); background:rgba(14,18,28,0.95);}
    .ledger-table tbody td {padding:12px; border-bottom:1px solid rgba(255,255,255,0.06); vertical-align:top;}
    .ledger-table tbody tr:last-child td {border-bottom:none;}
    .ledger-table code {font-size:12px;}
    .ledger-entries div {font-size:12px; margin-bottom:2px;}
    .ledger-nav {display:flex; gap:12px; flex-wrap:wrap; margin-top:20px;}
    .ledger-nav a{color:var(--accent-2);}
    @media (max-width:768px){
      .ledger-shell {padding:18px; border-radius:14px;}
      .ledger-table {min-width:0; font-size:0.85rem;}
      .ledger-table-wrap {margin-top:12px;}
      .ledger-table thead {display:none;}
      .ledger-table tbody tr {display:block; padding:12px; border-bottom:1px solid rgba(255,255,255,0.12);}
      .ledger-table tbody td {display:flex; justify-content:space-between; gap:8px; border:none; padding:6px 0;}
      .ledger-table tbody td::before {content:attr(data-label); font-weight:600; color:#e2e8f0;}
    }
  </style>

  <div class="ledger-shell accent-panel card-strip">
    <h1>{{.Content.Title}}</h1>
    <p class="muted">
      Page {{.Content.Page}} · Size {{.Content.Size}} · Chain:
      {{if .Content.OverallOK}}<span style="color:#72e0a8">OK</span>{{else}}<span style="color:#f87171">BROKEN</span>{{end}}
    </p>

    <div class="ledger-table-wrap">
      <table class="ledger-table">
        <thead>
          <tr>
            <th>Time (UTC)</th>
            <th>Reason</th>
            <th>Bet</th>
            <th>Note</th>
            <th>Prev Hash</th>
            <th>Hash</th>
            <th>Entries</th>
            <th>Chain</th>
          </tr>
        </thead>
        <tbody>
        {{range .Content.Rows}}
          <tr>
            <td data-label="Time">
              <span class="dt" data-iso="{{.CreatedAt.UTC.Format "2006-01-02T15:04:05Z07:00" }}"></span>
            </td>
            <td data-label="Reason">{{.Reason}}</td>
            <td data-label="Bet">{{if .BetID}}{{if .BetTitle}}<a href="/bets/{{.BetID}}">{{.BetTitle}}</a>{{else}}{{.BetID}}{{end}}{{else}}—{{end}}</td>
            <td data-label="Note">{{if .Note}}{{.Note}}{{else}}—{{end}}</td>
            {{if .PrevHash}}
            <td data-label="Prev"><code style="color:#{{.PrevHash | trunc 6 }}">{{.PrevHash | trunc 12 }}</code></td>
            {{else}}
            <td data-label="Prev"><code>{{.PrevHash }}</code></td>
            {{end}}
            <td data-label="Hash"><code style="color:#{{.Hash | trunc 6 }}">{{.Hash | trunc 12}}</code></td>
            <td data-label="Entries" class="ledger-entries">
              {{range .Entries}}
                <div>
                {{if eq .AccountKind "wallet"}}
                  <b>user</b>: {{if .DisplayName}}{{.DisplayName}}{{else}}(unknown){{end}} · Δ {{.Delta}}
                {{else}}
                  escrow · Δ {{.Delta}}
                {{end}}
                </div>
              {{end}}
            </td>
            <td data-label="Chain">{{if .ChainOK}}✅{{else}}❌{{end}}</td>
          </tr>
        {{end}}
        </tbody>
      </table>
    </div>

    <nav class="ledger-nav">
      {{if .Content.HasPrev}}<a href="{{.Content.PrevURL}}">← Prev</a>{{end}}
      {{if .Content.HasNext}}<a href="{{.Content.NextURL}}">Next →</a>{{end}}
    </nav>

    <p class="muted" style="margin-top:12px">
      Tip: This checks continuity within the current page. Full verification requires scanning from the first transaction.
    </p>
  </div>
{{end}}
